import argparse
from asm.train_test.train import train_model
from asm.train_test.test import test_model


def argument_parse():
    """
    Parse arguments and return them.
    :return: User-defined arguments.
    """
    parser = argparse.ArgumentParser(description="Malware Classification.")
    parser.add_argument("mode", help="specify \"train\" or \"test\"")
    parser.add_argument("--name", help="the name of model ([LSTM_DPCNN](default) | [DPCNN] | [LSTM])",
                        metavar="", default="LSTM_DPCNN")
    parser.add_argument("--epoch", type=int, help="number of iterations to train model (default: 20)", metavar="",
                        default=20)
    parser.add_argument("--model", help="the path of model, which is used to save or load model", metavar="",
                        required=True)
    args = parser.parse_args()

    return args


def run_asm():
    args = argument_parse()

    """---Check if the command is correct---"""
    if args.mode not in ["train", "test"]:
        print("Please specify the correct mode (\"train\" or \"test\").)\n"
              "Use \"python main.py -h\" to get help.")
    if args.name not in ["LSTM_DPCNN", "DPCNN", "LSTM"]:
        print("Please specify the correct name of model (\"LSTM_DPCNN\", \"DPCNN\" or \"LSTM\").\n"
              "Use \"python main.py -h\" to get help.")

    if args.mode == 'train':
        # train model
        train_model(args.name, args.model, args.epoch)
    elif args.mode == 'test':
        # test model
        test_model(args.name, args.model)


if __name__ == "__main__":
    run_asm()
