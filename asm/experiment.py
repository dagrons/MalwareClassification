from asm.train_test.train import train_model
from asm.train_test.test import test_model

import shutil
import os


def run():
    if not os.path.exists('../best_model/'):
        os.mkdir('../best_model/')

    names = ["LSTM_DPCNN", "DPCNN", "LSTM"]
    model = "../model/model.pth"

    with open('../results.md', 'a+') as f:
        f.write("|model|epoch|accuracy|\n|:---:|:---:|:---:|\n")
    for name in names:
        best_accuracy = 0.90
        for epoch in range(10, 30, 5):
            train_model(name, model, epoch)
            accuracy = test_model(name, model).item()

            if accuracy > best_accuracy:
                best_accuracy = accuracy
                shutil.move(model, '../best_model/' + name + '.pth')

            with open('../results.md', 'a+') as f:
                f.write('|' + name + '|' + str(epoch) + '|' + str(accuracy) + '|\n')
